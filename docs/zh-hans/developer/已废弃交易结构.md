# 已废弃交易结构

本文档包含了所有已废弃的交易，除非需要解析旧的历史交易，否则可以忽略这些交易。

## 反向解析相关交易 v1

### 声明反向解析(DeclareReverseRecord)

> **Deprecated**！此交易已被废弃，此文档仅供交易解析使用。

该交易可以将一个账户/子账户标记为某个地址的解析记录。

> ReverseRecordCell 的创建是不受数量限制的，当发生重复创建时，会遵循[特定的去重规则](Cell-结构协议.md#ReverseRecordCell)取唯一一个。

**action 结构**

```
table ActionData {
  action: "declare_reverse_record",
  params: [],
}
```

**交易结构**

```
CellDeps:
  das-lock
  balance-cell-type
  reverse-record-cell-type
  ConfigCellMain
  ConfigCellReverseResolution
Inputs:
  BalanceCell {1,}
Outputs:
  ReverseRecordCell
  [BalanceCell]
```

**约定**

- ReverseRecordCell 的 lock 必须和 inputs[0] 的 BalanceCell 一致，如此才能保证反向解析只有拥有对应地址私钥才能声明；
- ReverseRecordCell 必须是 das-lock；

### 变更反向解析(RedeclareReverseRecord)

> **Deprecated**！此交易已被废弃，此文档仅供交易解析使用。

该交易可以修改一条现存反向解析对应的账户。

**action 结构**

```
table ActionData {
  action: "redeclare_reverse_record",
  params: [],
}
```

**交易结构**

```
CellDeps:
  das-lock
  balance-cell-type
  reverse-record-cell-type
  ConfigCellMain
  ConfigCellReverseResolution
Inputs:
  ReverseRecordCell
Outputs:
  ReverseRecordCell
```

**约定**

- 只能修改 ReverseRecordCell.data.account；

### 撤销反向解析(RetractReverseRecord)

> **Deprecated**！此交易将在不久后完全废弃，此文档仅供交易解析使用。

该交易可以撤销一条或多条反向解析声明。

**action 结构**

```
table ActionData {
  action: "retract_reverse_record",
  params: [],
}
```

**交易结构**

```
CellDeps:
  das-lock
  balance-cell-type
  reverse-record-cell-type
  ConfigCellMain
  ConfigCellReverseResolution
Inputs:
  ReverseRecordCell {1,}
Outputs:
  BalanceCell {1,}
```

**约定**

- outputs 中必须包含等额于 inputs 中 ReverseRecordCell 存储费的退款；

## 子账户相关交易 v1

### 创建子账户(CreateSubAccount)

开启子账户后，用户可以通过此交易创建子账户。

**action 结构**

```
table ActionData {
  action: "create_sub_account",
  params: [0x00/0x01], // owner 或 manager 均可创建子账户
}
```

**交易结构**

```
CellDeps:
  das-lock
  account-cell-type
  sub-account-cell-type
  TimeCell
  HeightCell
  [QuoteCell]    // 如果用户设置了自定义脚本，那么就需要将 QuoteCell 放入 cell_deps
  ConfigCellAccount
  ConfigCellSubAccount
  AccountCell
  [CustomScriptCell] // 如果 SubAccountCell 定义了自定义脚本，那么就需要引用该脚本
Inputs:
  SubAccountCell
  BalanceCell {1,}
Outputs:
  SubAccountCell // 子账户的默克尔根必须更新到最终状态
  [BalanceCell]
```

**约定**

- owner 或 manager 均有权限创建子账户；
- AccountCell 必须未处于**宽限期**或之后的状态；
- 未设置自定义脚本时：
  - 每个子账户的注册费等于 `ConfigCellSubAccount.new_sub_account_price`；
- 设置了自定义脚本时：
  - 每个子账户的注册费由自定义脚本约束，注册费需存放于 `SubAccountCell.capacity`，并按照 `ConfigCellSubAccount.new_sub_account_custom_price_das_profit_rate`
    分别在 `SubAccountCell.data.das_profit` 和 `SubAccountCell.data.owner_profit` 记录累计后的利润分配额；
  - 所有输入输出的 BalanceCell 只能使用一致的 lock ；

### 编辑子账户(EditSubAccount)

子账户的持有用户可以通过此交易编辑子账户以进行转让、修改管理员、修改解析记录等操作。

**action 结构**

```
table ActionData {
  action: "edit_sub_account",
  params: [],
}
```

**交易结构**

```
CellDeps:
  das-lock
  sub-account-cell-type
  TimeCell
  HeightCell
  ConfigCellSubAccount
  AccountCell
Inputs:
  SubAccountCell
Outputs:
  SubAccountCell // 子账户的默克尔根必须更新到最终状态
```

**约定**

- AccountCell 必须未处于**宽限期**或之后的状态；
- 这笔交易可以从 SubAccountCell 中扣除的手续费不得高于 `ConfigCellSubAccount.edit_fee` 中配置值；
